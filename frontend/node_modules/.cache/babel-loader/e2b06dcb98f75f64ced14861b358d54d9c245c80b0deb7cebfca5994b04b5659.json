{"ast":null,"code":"import React,{createContext,useState,useEffect}from'react';import authService from'../services/authService';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const fetchUser=async()=>{try{// Only clear redirect data if user is not on login or checkout pages\nconst currentPath=window.location.pathname;if(currentPath!=='/checkout'&&currentPath!=='/login'){// Clear redirect only if it's not a checkout redirect\nconst storedRedirect=localStorage.getItem('redirectAfterLogin');if(storedRedirect!=='/checkout'){localStorage.removeItem('redirectAfterLogin');}}// Check if user should be remembered and if session hasn't expired\nconst rememberUser=localStorage.getItem('rememberUser');const authExpiration=localStorage.getItem('authExpiration');if(rememberUser&&authExpiration){const expirationTime=parseInt(authExpiration);if(Date.now()>expirationTime){// Session expired, clear data\nlocalStorage.removeItem('authExpiration');localStorage.removeItem('rememberUser');localStorage.removeItem('token');setUser(null);setLoading(false);return;}}const userData=await authService.getCurrentUser();setUser(userData);console.log('✅ User authenticated:',userData);}catch(err){console.log('ℹ️ No authenticated user');setUser(null);// Clear expired session data\nlocalStorage.removeItem('authExpiration');localStorage.removeItem('rememberUser');}finally{setLoading(false);}};fetchUser();},[]);const login=async credentials=>{try{const userData=await authService.login(credentials);setUser(userData);// Set remember me for 7 days if user wants to stay logged in\nconst rememberMe=credentials.rememberMe||true;// Default to 7 days\nif(rememberMe){const expirationTime=Date.now()+7*24*60*60*1000;// 7 days\nlocalStorage.setItem('authExpiration',expirationTime.toString());localStorage.setItem('rememberUser','true');}console.log('✅ Login successful:',userData);return userData;}catch(error){console.error('❌ Login failed:',error);throw error;}};const logout=async()=>{try{await authService.logout();setUser(null);console.log('✅ Logout successful');// Clear all authentication data\nlocalStorage.removeItem('guestCart');localStorage.removeItem('authExpiration');localStorage.removeItem('rememberUser');localStorage.removeItem('token');}catch(error){console.error('❌ Logout failed:',error);// Still clear user state even if backend call fails\nsetUser(null);localStorage.removeItem('guestCart');localStorage.removeItem('authExpiration');localStorage.removeItem('rememberUser');localStorage.removeItem('token');}};const updateProfile=async profileData=>{try{await authService.updateProfile(profileData);// Fetch updated user data\nconst updatedUser=await authService.getCurrentUser();setUser(updatedUser);console.log('✅ Profile updated:',updatedUser);return updatedUser;}catch(error){console.error('❌ Profile update failed:',error);throw error;}};const isAuthenticated=!!user;return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,loading,isAuthenticated,login,logout,updateProfile},children:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","authService","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","loading","setLoading","fetchUser","currentPath","window","location","pathname","storedRedirect","localStorage","getItem","removeItem","rememberUser","authExpiration","expirationTime","parseInt","Date","now","userData","getCurrentUser","console","log","err","login","credentials","rememberMe","setItem","toString","error","logout","updateProfile","profileData","updatedUser","isAuthenticated","Provider","value"],"sources":["D:/food_delievery2/frontend/src/assets/Context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\nimport authService from '../services/authService';\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const fetchUser = async () => {\r\n      try {\r\n        // Only clear redirect data if user is not on login or checkout pages\r\n        const currentPath = window.location.pathname;\r\n        if (currentPath !== '/checkout' && currentPath !== '/login') {\r\n          // Clear redirect only if it's not a checkout redirect\r\n          const storedRedirect = localStorage.getItem('redirectAfterLogin');\r\n          if (storedRedirect !== '/checkout') {\r\n            localStorage.removeItem('redirectAfterLogin');\r\n          }\r\n        }\r\n        \r\n        // Check if user should be remembered and if session hasn't expired\r\n        const rememberUser = localStorage.getItem('rememberUser');\r\n        const authExpiration = localStorage.getItem('authExpiration');\r\n        \r\n        if (rememberUser && authExpiration) {\r\n          const expirationTime = parseInt(authExpiration);\r\n          if (Date.now() > expirationTime) {\r\n            // Session expired, clear data\r\n            localStorage.removeItem('authExpiration');\r\n            localStorage.removeItem('rememberUser');\r\n            localStorage.removeItem('token');\r\n            setUser(null);\r\n            setLoading(false);\r\n            return;\r\n          }\r\n        }\r\n\r\n        const userData = await authService.getCurrentUser();\r\n        setUser(userData);\r\n        console.log('✅ User authenticated:', userData);\r\n      } catch (err) {\r\n        console.log('ℹ️ No authenticated user');\r\n        setUser(null);\r\n        // Clear expired session data\r\n        localStorage.removeItem('authExpiration');\r\n        localStorage.removeItem('rememberUser');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchUser();\r\n  }, []);\r\n\r\n  const login = async (credentials) => {\r\n    try {\r\n      const userData = await authService.login(credentials);\r\n      setUser(userData);\r\n      \r\n      // Set remember me for 7 days if user wants to stay logged in\r\n      const rememberMe = credentials.rememberMe || true; // Default to 7 days\r\n      if (rememberMe) {\r\n        const expirationTime = Date.now() + (7 * 24 * 60 * 60 * 1000); // 7 days\r\n        localStorage.setItem('authExpiration', expirationTime.toString());\r\n        localStorage.setItem('rememberUser', 'true');\r\n      }\r\n      \r\n      console.log('✅ Login successful:', userData);\r\n      return userData;\r\n    } catch (error) {\r\n      console.error('❌ Login failed:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await authService.logout();\r\n      setUser(null);\r\n      console.log('✅ Logout successful');\r\n      \r\n      // Clear all authentication data\r\n      localStorage.removeItem('guestCart');\r\n      localStorage.removeItem('authExpiration');\r\n      localStorage.removeItem('rememberUser');\r\n      localStorage.removeItem('token');\r\n    } catch (error) {\r\n      console.error('❌ Logout failed:', error);\r\n      // Still clear user state even if backend call fails\r\n      setUser(null);\r\n      localStorage.removeItem('guestCart');\r\n      localStorage.removeItem('authExpiration');\r\n      localStorage.removeItem('rememberUser');\r\n      localStorage.removeItem('token');\r\n    }\r\n  };\r\n\r\n  const updateProfile = async (profileData) => {\r\n    try {\r\n      await authService.updateProfile(profileData);\r\n      // Fetch updated user data\r\n      const updatedUser = await authService.getCurrentUser();\r\n      setUser(updatedUser);\r\n      console.log('✅ Profile updated:', updatedUser);\r\n      return updatedUser;\r\n    } catch (error) {\r\n      console.error('❌ Profile update failed:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const isAuthenticated = !!user;\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ \r\n      user, \r\n      loading, \r\n      isAuthenticated,\r\n      login, \r\n      logout, \r\n      updateProfile \r\n    }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}